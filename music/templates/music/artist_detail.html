{% extends "ui/base.html" %}

{% load static radio %}

{% block title %}{{ artist.name }}{% endblock %}

{% block script %}
<script type="text/javascript">
    var chartData = [
    {% for k, v in chart_data %}[{{ k|date_to_ms }}, {{ v }}],{% endfor %}
    ];
</script>
<script src="{% static 'artist_detail.min.js' %}" type="text/javascript"></script>
{% endblock %}

{% block content %}
<div class="grid-container" id="artists-page">

    <h1>
        {{ artist.name }}
        {% if user.is_superuser %}
            <button class="button" data-open="rename-modal">Rename</button>
        {% endif %}
    </h1>

    {% if user.is_superuser %}
    <div id="rename-modal" class="reveal" data-reveal>
        <h3>Choose default artist name</h3>

        <form action="{% url 'music:set-artist-name' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="artist" value="{{ artist.pk }}" />
            <ul>
            {% for name in artist.names.all %}
                <li>
                    <label>
                        <input type="radio" name="name" value="{{ name.pk }}" />
                        {{ name.name }}
                    </label>
                </li>
            {% endfor %}
            </ul>

            <button type="submit" id="merge-artists" class="button">Make default</button>
        </form>

        <button class="close-button" data-close aria-label="Close modal" type="button">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    {% endif %}

    <div class="grid-x grid-margin-x small-up-1 medium-up-2">
        <div class="small-6 cell">
            <h3>Most played by</h3>

            <table class="hover">
                <thead>
                    <tr>
                        <th>Radio</th>
                        <th>Play count</th>
                    </tr>
                </thead>
                <tbody>
                    {% for radio in radios %}
                    <tr>
                        <td>{{ radio.1 }}</td>
                        <td>{{ radio.2 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="small-6 cell">
            <h3>Greatest hits</h3>

            <table class="hover">
                <thead>
                    <tr>
                        <th>Song</th>
                        <th>Play count</th>
                    </tr>
                </thead>
                <tbody>
                    {% for song in songs %}
                    <tr>
                        <td>{{ song.0 }}</td>
                        <td>{{ song.1 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div id="plays-chart"></div>

    <h3>Recent plays</h3>

    <table class="hover">
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>Radio</th>
                <th>Song</th>
            </tr>
        </thead>
        <tbody>
            {% for play in plays %}
            <tr>
                <td>{{ play.timestamp|date:"Y-m-d H:i:s" }}</td>
                <td>{{ play.radio.name }}</td>
                <td>{{ play.title }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>
{% endblock %}
